<div class="widget">
  <div class="title">Song Requests</div>
  <div class="controls">
    <div class="dropdown">
      <a data-id="songrequest-widget" onclick="commons.minimize(this)"><span class="glyphicon glyphicon-resize-small text-muted"></span></a>
      <a id="SRMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
        <span class="glyphicon glyphicon-option-vertical text-muted"></span>
      </a>
      <ul class="dropdown-menu" aria-labelledby="SRMenu">
        <li><a href="#" onclick="deleteWidget('songrequests')" style="color: #a94442;">Delete widget</a></li>
      </ul>
    </div>
  </div>
  <div id="songrequest-widget">
    <table id="songRequestsWidget" class="table table-condensed"></table>
  </div>
</div>

<script>
  if (loadedJS.indexOf('songrequests') === -1) {
    loadedJS.push('songrequests')
      // get song requests
    setInterval(function() {
      socket.emit('getSongRequests');
    }, 2000)
    socket.on('songRequestsList', function(list) {
      $("table#songRequestsWidget").empty();
      if (_.isEmpty(list)) {
        $("table#songRequestsWidget").append('<tr><td colspan=3 class="text-info text-center"><strong>No song requests found</strong></td></tr>');
      }
      for (var index in list) {
        if (list.hasOwnProperty(index)) {
          var title = list[index].title,
            requestedBy = list[index].username,
            length_seconds = list[index].length_seconds,
            videoID = list[index].videoID;
          $("table#songRequestsWidget").append('<tr><td>' + (new Date(length_seconds * 1000)).toUTCString().match(/(\d\d:\d\d:\d\d)/)[0] + '</td><td>' + title + '</td><td>' + requestedBy + '</td></tr>');
        }
      }
    });
  }
</script>