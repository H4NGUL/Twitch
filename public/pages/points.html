<div class="col-xs-12 col-sm-12 col-md-6 col-lg-8">
  <div class="widget">
    <div class="title">Points</div>
    <table class="table table-striped table-responsive table-condensed">
      <thead>
        <tr>
          <th>User</th>
          <th>Points</th>
        </tr>
      </thead>
      <tbody id="Points" >
      </tbody>
    </table>
  </div>
</div>

<div class="col-xs-12 col-sm-12 col-md-6 col-lg-4">
  <div class="widget">
    <div class="title">Settings</div>
    <table class="table table-striped">
      <tr>
        <td><strong>Points Name</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="pointsName" onclick="commons.configEditable(this, '')" id="configPointsName"></abbr>
          <div class="input-group" style="display:none;" id="input_pointsName_group">
            <div class="input-group-addon">single|multi</div>
            <input style="width: 6em" id="input_pointsName" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Points Response</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="pointsResponse" onclick="commons.configEditable(this, '')" id="configPointsResponse"></abbr>
          <div class="input-group" style="display:none;" id="input_pointsResponsen_group">
            <div class="input-group-addon">string</div>
            <input style="width: 6em" id="input_pointsResponse" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Points Interval</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="pointsInterval" onclick="commons.configEditable(this, 'min')" id="configPointsInterval"></abbr>
          <div class="input-group" style="display:none;" id="input_pointsInterval_group">
            <div class="input-group-addon">min</div>
            <input style="width: 6em" id="input_pointsInterval" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Points per Interval</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="pointsPerInterval" onclick="commons.configEditable(this, '')" id="configPointsPerInterval"></abbr>
          <div class="input-group" style="display:none;" id="input_pointsPerInterval_group">
            <div class="input-group-addon">points</div>
            <input style="width: 6em" id="input_pointsPerInterval" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Points Interval (offline)</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="pointsIntervalOffline" onclick="commons.configEditable(this, 'min')" id="configPointsIntervalOffline"></abbr>
          <div class="input-group" style="display:none;" id="input_pointsIntervalOffline_group">
            <div class="input-group-addon">min</div>
            <input style="width: 6em" id="input_pointsIntervalOffline" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
      <tr>
        <td><strong>Points per Interval (offline)</strong></td>
        <td>
          <abbr title="click to edit" data-config-id="pointsPerIntervalOffline" onclick="commons.configEditable(this, '')" id="configPointsPerIntervalOffline"></abbr>
          <div class="input-group" style="display:none;" id="input_pointsPerIntervalOffline_group">
            <div class="input-group-addon">points</div>
            <input style="width: 6em" id="input_pointsPerIntervalOffline" class="form-control input-sm" type="text"/>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>
<script>
  var points = {
    update: function (list) {
      $("#Points").empty()
      _.each(list, function(item, index) {
        $("#Points").append('<tr>' +
          '<td>' + item.username + '</td>' +
          '<td>' +
          '<abbr title="click to edit" data-id="' + item.username + '" onclick="points.makeEditable(this)">' +  item.points + '</abbr>' +
          '<input id="points_' + item.username + '" style="width: 6em; display: none" class="form-control input-sm" type="text"/>' +
          '</td>' +
        '</tr>');
      })
    },
    makeEditable: function(el) {
      var $input = $('#points_' + el.dataset.id)
      $(el).css('display', 'none')
      $input.css('display', 'table')
      $input.focus()
      $input.val($(el).text())

      $input.off()
      $input.on('focusout', function() {
        var value = $input.val()
        $input.css('display', 'none')
        $(el).css('display', 'inline')
        $(el).text(value)
        socket.emit('setPoints', {username: el.dataset.id, value: value})
      })
    }
  }

  socket.emit('getPoints');
  socket.emit('getPointsConfiguration')

  socket.on('Points', function(list) {
    points.update(list)
  });

  socket.on('pointsConfiguration', function(data) {
    $("#configPointsName").text(data.pointsName)
    $("#configPointsResponse").text(data.pointsResponse)
    $("#configPointsInterval").text(data.pointsInterval)
    $("#configPointsPerInterval").text(data.pointsPerInterval)
    $("#configPointsIntervalOffline").text(data.pointsIntervalOffline)
    $("#configPointsPerIntervalOffline").text(data.pointsPerIntervalOffline)
  })
</script>